-- // Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local LocalPlayer = Players.LocalPlayer

-- // Fly Vars
local velocityHandlerName = "FlyVelocity_"..math.random(1000,9999)
local gyroHandlerName = "FlyGyro_"..math.random(1000,9999)
local flying = false
local flySpeed = 100

-- // Helpers
local function getRoot(char)
	return char and char:FindFirstChild("HumanoidRootPart")
end

-- // Start Fly
local function mobileFly()
	if flying then return end
	local char = LocalPlayer.Character
	local root = getRoot(char)
	if not root then return end
	local hum = char:FindFirstChildOfClass("Humanoid")
	if not hum then return end

	flying = true
	local camera = workspace.CurrentCamera

	hum:SetStateEnabled(Enum.HumanoidStateType.FallingDown, false)
	hum:SetStateEnabled(Enum.HumanoidStateType.Ragdoll, false)
	hum:SetStateEnabled(Enum.HumanoidStateType.Freefall, false)
	hum:ChangeState(Enum.HumanoidStateType.Physics)

	local bv = Instance.new("BodyVelocity")
	bv.Name = velocityHandlerName
	bv.MaxForce = Vector3.new(9e9, 9e9, 9e9)
	bv.Velocity = Vector3.zero
	bv.Parent = root

	local bg = Instance.new("BodyGyro")
	bg.Name = gyroHandlerName
	bg.MaxTorque = Vector3.new(9e9, 9e9, 9e9)
	bg.P = 1000
	bg.D = 50
	bg.Parent = root

	local controlModule = require(LocalPlayer.PlayerScripts:WaitForChild("PlayerModule"):WaitForChild("ControlModule"))

	RunService.RenderStepped:Connect(function()
		if not flying or not root or not bv or not bg then return end
		local moveDir = controlModule:GetMoveVector()
		bg.CFrame = camera.CFrame

		local vel = Vector3.zero
		if moveDir.Magnitude > 0 then
			vel = (camera.CFrame.RightVector * moveDir.X + camera.CFrame.LookVector * -moveDir.Z) * flySpeed
		end
		bv.Velocity = vel

		if hum then
			hum:ChangeState(Enum.HumanoidStateType.Physics)
		end
	end)
end

-- // Stop Fly
local function stopFly()
	flying = false
	local char = LocalPlayer.Character
	if char then
		local root = getRoot(char)
		if root then
			if root:FindFirstChild(velocityHandlerName) then root[velocityHandlerName]:Destroy() end
			if root:FindFirstChild(gyroHandlerName) then root[gyroHandlerName]:Destroy() end
		end
		local hum = char:FindFirstChildWhichIsA("Humanoid")
		if hum then
			hum:SetStateEnabled(Enum.HumanoidStateType.FallingDown, true)
			hum:SetStateEnabled(Enum.HumanoidStateType.Ragdoll, true)
			hum:SetStateEnabled(Enum.HumanoidStateType.Freefall, true)
			hum:ChangeState(Enum.HumanoidStateType.GettingUp)
		end
	end
end

-- // GUI
local ScreenGui = Instance.new("ScreenGui", LocalPlayer.PlayerGui)
ScreenGui.Name = "CustomMenu"

local MainFrame = Instance.new("Frame", ScreenGui)
MainFrame.Size = UDim2.new(0, 250, 0, 350)
MainFrame.Position = UDim2.new(0.5, -125, 0.3, 0)
MainFrame.BackgroundColor3 = Color3.fromRGB(240, 240, 240)
MainFrame.Active = true
MainFrame.Draggable = true

local stroke = Instance.new("UIStroke", MainFrame)
stroke.Thickness = 5
stroke.Color = Color3.fromRGB(255, 200, 255)

local corner = Instance.new("UICorner", MainFrame)
corner.CornerRadius = UDim.new(0, 15)

-- Title Bar
local TitleBar = Instance.new("Frame", MainFrame)
TitleBar.Size = UDim2.new(1, 0, 0, 40)
TitleBar.BackgroundTransparency = 1

local VersionLabel = Instance.new("TextLabel", TitleBar)
VersionLabel.Size = UDim2.new(0.5, 0, 1, 0)
VersionLabel.Position = UDim2.new(0, 10, 0, 0)
VersionLabel.Text = "Versi : 0.0.1"
VersionLabel.Font = Enum.Font.GothamBold
VersionLabel.TextColor3 = Color3.fromRGB(50, 50, 50)
VersionLabel.TextScaled = true
VersionLabel.BackgroundTransparency = 1
VersionLabel.TextXAlignment = Enum.TextXAlignment.Left

local MinBtn = Instance.new("TextButton", TitleBar)
MinBtn.Size = UDim2.new(0, 40, 0, 25)
MinBtn.Position = UDim2.new(1, -45, 0.5, -12)
MinBtn.Text = "-"
MinBtn.Font = Enum.Font.GothamBold
MinBtn.TextScaled = true
MinBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
MinBtn.BackgroundColor3 = Color3.fromRGB(200, 100, 200)

local minCorner = Instance.new("UICorner", MinBtn)
minCorner.CornerRadius = UDim.new(0, 6)

-- Tombol Helper
local function makeButton(text, yPos)
	local btn = Instance.new("TextButton", MainFrame)
	btn.Size = UDim2.new(0.85, 0, 0, 50)
	btn.Position = UDim2.new(0.5, -100, 0, yPos)
	btn.Text = text
	btn.Font = Enum.Font.GothamBold
	btn.TextScaled = true
	btn.TextColor3 = Color3.fromRGB(255,255,255)
	btn.BackgroundColor3 = Color3.fromRGB(50,50,150)

	local corner = Instance.new("UICorner", btn)
	corner.CornerRadius = UDim.new(0, 12)

	return btn
end

local FlyBtn = makeButton("TERBANG", 60)
local StopFlyBtn = makeButton("BERHENTI TERBANG", 120)
local TeleBtn = makeButton("TELEPORT", 180)

-- Frame List Checkpoint
local listFrame = Instance.new("Frame", ScreenGui)
listFrame.Size = UDim2.new(0, 200, 0, 200)
listFrame.Position = UDim2.new(0.5, -100, 0.3, 200)
listFrame.BackgroundColor3 = Color3.fromRGB(240,240,255)
listFrame.Visible = false
local listCorner = Instance.new("UICorner", listFrame)
listCorner.CornerRadius = UDim.new(0,12)

-- Koordinat realtime
local coordLabel = Instance.new("TextLabel", ScreenGui)
coordLabel.Size = UDim2.new(0,200,0,25)
coordLabel.Position = UDim2.new(0.5,-100,0,520)
coordLabel.BackgroundColor3 = Color3.fromRGB(230,230,230)
coordLabel.TextColor3 = Color3.fromRGB(0,0,0)
coordLabel.TextScaled = true
coordLabel.Text = "Koordinat: (0,0,0)"

RunService.RenderStepped:Connect(function()
	local char = LocalPlayer.Character
	local root = char and char:FindFirstChild("HumanoidRootPart")
	if root then
		local pos = root.Position
		coordLabel.Text = string.format("Koordinat: (%.1f, %.1f, %.1f)", pos.X, pos.Y, pos.Z)
	end
end)

-- Checkpoint functions
local function getCheckpoints()
	local checkpoints = {}
	for _, obj in pairs(workspace:GetDescendants()) do
		if obj:IsA("SpawnLocation") or obj.Name:lower():match("checkpoint") then
			table.insert(checkpoints, obj)
		end
	end
	return checkpoints
end

local function refreshCheckpointList()
	for _, child in pairs(listFrame:GetChildren()) do
		if child:IsA("TextButton") then
			child:Destroy()
		end
	end

	local checkpoints = getCheckpoints()
	for i, cp in ipairs(checkpoints) do
		local btn = Instance.new("TextButton", listFrame)
		btn.Size = UDim2.new(1,0,0,25)
		btn.Position = UDim2.new(0,0,0,(i-1)*30)
		btn.Text = i..". "..cp.Name
		btn.BackgroundColor3 = Color3.fromRGB(220,220,240)

		btn.MouseButton1Click:Connect(function()
			local char = LocalPlayer.Character
			local root = char and char:FindFirstChild("HumanoidRootPart")
			if root and cp then
				root.CFrame = cp.CFrame + Vector3.new(0,5,0)
			end
		end)
	end
end

-- Logo untuk restore GUI saat minimized
local OpenLogo = Instance.new("ImageButton", ScreenGui)
OpenLogo.Size = UDim2.new(0,50,0,50)
OpenLogo.Position = UDim2.new(0,20,0.5,-25)
OpenLogo.Image = "rbxassetid://93768214580798" -- Asset BARDENSS-SC
OpenLogo.Visible = false

local function minimizeGUI()
	MainFrame.Size = UDim2.new(0,250,0,40)
	for _, child in pairs(MainFrame:GetChildren()) do
		if child ~= TitleBar then
			child.Visible = false
		end
	end
	OpenLogo.Visible = true
end

local function restoreGUI()
	MainFrame.Size = UDim2.new(0,250,0,350)
	for _, child in pairs(MainFrame:GetChildren()) do
		child.Visible = true
	end
	OpenLogo.Visible = false
end

-- Tombol Connections
FlyBtn.MouseButton1Click:Connect(mobileFly)
StopFlyBtn.MouseButton1Click:Connect(stopFly)
TeleBtn.MouseButton1Click:Connect(function()
	refreshCheckpointList()
	listFrame.Visible = not listFrame.Visible
end)

MinBtn.MouseButton1Click:Connect(function()
	if MainFrame.Size.Y.Offset > 40 then
		minimizeGUI()
	else
		restoreGUI()
	end
end)

OpenLogo.MouseButton1Click:Connect(restoreGUI)

-- Animasi label Bardenss
local animLabel = Instance.new("TextLabel", ScreenGui)
animLabel.Size = UDim2.new(0,300,0,50)
animLabel.Position = UDim2.new(0.5,-150,0.5,-25)
animLabel.BackgroundTransparency = 1
animLabel.Text = "Ｂａｒｄｅｎｓｓ"
animLabel.TextColor3 = Color3.fromRGB(255,150,255)
animLabel.Font = Enum.Font.Fantasy
animLabel.TextScaled = true

TweenService:Create(animLabel, TweenInfo.new(2), {TextTransparency = 1}):Play()
task.wait(2)
animLabel:Destroy()