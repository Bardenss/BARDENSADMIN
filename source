-- ==========================
-- Bardenss 3D Fly Mobile (Android)
-- ==========================
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local RunService = game:GetService("RunService")

local hrp = nil
local hum = nil
local flying = false
local speed = 50
local flyConn

-- GUI
local gui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
gui.Name = "BardenssFlyUI"

local MainFrame = Instance.new("Frame", gui)
MainFrame.Size = UDim2.new(0,220,0,120)
MainFrame.Position = UDim2.new(0,50,0,150)
MainFrame.BackgroundColor3 = Color3.fromRGB(255,200,230)

local UICorner = Instance.new("UICorner", MainFrame)
UICorner.CornerRadius = UDim.new(0,12)

local Title = Instance.new("TextLabel", MainFrame)
Title.Size = UDim2.new(1,0,0,30)
Title.BackgroundTransparency = 1
Title.Text = "Bardenss Fly"
Title.Font = Enum.Font.Cartoon
Title.TextSize = 20

local FlyButton = Instance.new("TextButton", MainFrame)
FlyButton.Size = UDim2.new(0,180,0,50)
FlyButton.Position = UDim2.new(0,20,0,50)
FlyButton.BackgroundColor3 = Color3.fromRGB(255,180,220)
FlyButton.Text = "Fly"

-- Minimize Button
local MinimizeButton = Instance.new("TextButton", MainFrame)
MinimizeButton.Size = UDim2.new(0,25,0,25)
MinimizeButton.Position = UDim2.new(1,-30,0,5)
MinimizeButton.Text = "-"

local minimized = false
MinimizeButton.MouseButton1Click:Connect(function()
    minimized = not minimized
    for _,obj in pairs(MainFrame:GetChildren()) do
        if obj ~= Title and obj ~= MinimizeButton then
            obj.Visible = not minimized
        end
    end
    MainFrame.Size = minimized and UDim2.new(0,220,0,40) or UDim2.new(0,220,0,120)
end)

-- ==========================
-- Fly Logic (3D, Android Joystick)
-- ==========================
local function StartFly()
    hrp = player.Character:WaitForChild("HumanoidRootPart")
    hum = player.Character:WaitForChildOfClass("Humanoid")

    local bg = Instance.new("BodyGyro", hrp)
    bg.P = 9e4
    bg.MaxTorque = Vector3.new(9e9,9e9,9e9)
    bg.CFrame = hrp.CFrame

    local bv = Instance.new("BodyVelocity", hrp)
    bv.MaxForce = Vector3.new(9e9,9e9,9e9)
    bv.Velocity = Vector3.new(0,0,0)

    flyConn = RunService.RenderStepped:Connect(function()
        if flying and hrp and hum then
            local camCF = workspace.CurrentCamera.CFrame
            bg.CFrame = camCF

            local moveDir = hum.MoveDirection
            local dir = (camCF.LookVector * moveDir.Z) + (camCF.RightVector * moveDir.X) + Vector3.new(0, moveDir.Y, 0)
            if dir.Magnitude > 0 then
                dir = dir.Unit * speed
            end
            bv.Velocity = dir
        end
    end)
end

local function StopFly()
    if hrp and hrp:FindFirstChild("BodyGyro") then hrp.BodyGyro:Destroy() end
    if hrp and hrp:FindFirstChild("BodyVelocity") then hrp.BodyVelocity:Destroy() end
    if flyConn then flyConn:Disconnect() flyConn=nil end
end

-- Fly toggle
FlyButton.MouseButton1Click:Connect(function()
    flying = not flying
    if flying then
        FlyButton.Text = "Fly: ON"
        FlyButton.BackgroundColor3 = Color3.fromRGB(0,200,0)
        StartFly()
    else
        FlyButton.Text = "Fly: OFF"
        FlyButton.BackgroundColor3 = Color3.fromRGB(200,0,0)
        StopFly()
    end
end)

-- Reset saat respawn
player.CharacterAdded:Connect(function()
    flying = false
    StopFly()
    FlyButton.Text = "Fly"
    FlyButton.BackgroundColor3 = Color3.fromRGB(255,180,220)
end)