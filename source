--// Bardenss Cute Fly (Joystick ikut Kamera) \\--

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

local flyConnection, flyGyro, flyVelocity
local FLYING = false
local flySpeed = 50

-- =============== STOP FLY ===============
local function stopFly()
    FLYING = false
    if flyConnection then flyConnection:Disconnect() flyConnection = nil end
    if flyGyro then flyGyro:Destroy() flyGyro = nil end
    if flyVelocity then flyVelocity:Destroy() flyVelocity = nil end
    local hum = LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
    if hum then hum.PlatformStand = false end
end

-- =============== START FLY ===============
local function startFly()
    stopFly()
    FLYING = true

    local char = LocalPlayer.Character
    if not char then return end
    local hrp = char:WaitForChild("HumanoidRootPart")
    local hum = char:FindFirstChildOfClass("Humanoid")

    hum.PlatformStand = true

    flyVelocity = Instance.new("BodyVelocity")
    flyVelocity.MaxForce = Vector3.new(1e9, 1e9, 1e9)
    flyVelocity.Parent = hrp

    flyGyro = Instance.new("BodyGyro")
    flyGyro.MaxTorque = Vector3.new(1e9, 1e9, 1e9)
    flyGyro.P = 1000
    flyGyro.D = 50
    flyGyro.Parent = hrp

    flyConnection = RunService.RenderStepped:Connect(function()
        if not FLYING then return end
        if not char or not hrp or not hum then return end

        local camCF = Camera.CFrame
        local moveDir = hum.MoveDirection

        -- buat basis arah kamera (forward & right di bidang XZ)
        local forward = Vector3.new(camCF.LookVector.X, 0, camCF.LookVector.Z).Unit
        local right = Vector3.new(camCF.RightVector.X, 0, camCF.RightVector.Z).Unit

        -- proyeksi joystick ke arah kamera
        local relativeMove = (forward * moveDir.Z + right * moveDir.X)

        -- naik/turun
        local yVel = 0
        if UserInputService:IsKeyDown(Enum.KeyCode.Space) then
            yVel = flySpeed
        elseif UserInputService:IsKeyDown(Enum.KeyCode.LeftShift) then
            yVel = -flySpeed
        end

        flyVelocity.Velocity = relativeMove * flySpeed + Vector3.new(0, yVel, 0)
        flyGyro.CFrame = camCF
    end)
end

-- =============== GUI ===============
local ScreenGui = Instance.new("ScreenGui", game.CoreGui)
ScreenGui.IgnoreGuiInset = true
ScreenGui.ResetOnSpawn = false

local MainFrame = Instance.new("Frame", ScreenGui)
MainFrame.Size = UDim2.new(0,200,0,50)
MainFrame.Position = UDim2.new(0,20,0,200)
MainFrame.BackgroundColor3 = Color3.fromRGB(255,200,220)
Instance.new("UICorner", MainFrame).CornerRadius = UDim.new(0,10)

local MinBtn = Instance.new("TextButton", MainFrame)
MinBtn.Size = UDim2.new(0,30,0,30)
MinBtn.Position = UDim2.new(1,-35,0,10)
MinBtn.Text = "-"
MinBtn.BackgroundColor3 = Color3.fromRGB(255,150,200)

local LogoBtn = Instance.new("TextButton", ScreenGui)
LogoBtn.Size = UDim2.new(0,40,0,40)
LogoBtn.Position = UDim2.new(0,20,0,200)
LogoBtn.Text = "B"
LogoBtn.Visible = false
LogoBtn.BackgroundColor3 = Color3.fromRGB(255,150,200)

MinBtn.MouseButton1Click:Connect(function()
    MainFrame.Visible = false
    LogoBtn.Visible = true
end)

LogoBtn.MouseButton1Click:Connect(function()
    MainFrame.Visible = true
    LogoBtn.Visible = false
end)

local FlyBtn = Instance.new("TextButton", MainFrame)
FlyBtn.Size = UDim2.new(0,150,0,30)
FlyBtn.Position = UDim2.new(0,10,0,10)
FlyBtn.Text = "Toggle Fly"
FlyBtn.BackgroundColor3 = Color3.fromRGB(255,170,200)

FlyBtn.MouseButton1Click:Connect(function()
    if FLYING then
        stopFly()
    else
        startFly()
    end
end)