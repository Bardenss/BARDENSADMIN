-- // Services ini
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

-- // Fly Vars
local velocityHandlerName = "FlyVelocity_"..math.random(1000,9999)
local gyroHandlerName = "FlyGyro_"..math.random(1000,9999)
local flying = false
local flySpeed = 100

-- // Helpers
local function getRoot(char)
	return char and char:FindFirstChild("HumanoidRootPart")
end

-- // Start Fly
local function mobileFly()
	if flying then return end
	local char = LocalPlayer.Character
	local root = getRoot(char)
	if not root then return end
	local hum = char:FindFirstChildOfClass("Humanoid")
	if not hum then return end

	flying = true
	local camera = workspace.CurrentCamera

	-- Disable fall damage
	hum:SetStateEnabled(Enum.HumanoidStateType.FallingDown, false)
	hum:SetStateEnabled(Enum.HumanoidStateType.Ragdoll, false)
	hum:SetStateEnabled(Enum.HumanoidStateType.Freefall, false)
	hum:ChangeState(Enum.HumanoidStateType.Physics)

	-- BodyVelocity
	local bv = Instance.new("BodyVelocity")
	bv.Name = velocityHandlerName
	bv.MaxForce = Vector3.new(9e9, 9e9, 9e9)
	bv.Velocity = Vector3.zero
	bv.Parent = root

	-- BodyGyro
	local bg = Instance.new("BodyGyro")
	bg.Name = gyroHandlerName
	bg.MaxTorque = Vector3.new(9e9, 9e9, 9e9)
	bg.P = 1000
	bg.D = 50
	bg.Parent = root

	-- Ambil ControlModule roblox (joystick bawaan)
	local controlModule = require(LocalPlayer.PlayerScripts:WaitForChild("PlayerModule"):WaitForChild("ControlModule"))

	-- Loop
	RunService.RenderStepped:Connect(function()
		if not flying or not root or not bv or not bg then return end
		local moveDir = controlModule:GetMoveVector()
		bg.CFrame = camera.CFrame

		local vel = Vector3.zero
		if moveDir.Magnitude > 0 then
			vel = (camera.CFrame.RightVector * moveDir.X + camera.CFrame.LookVector * -moveDir.Z) * flySpeed
		end
		bv.Velocity = vel

		-- pastikan terus state aman
		if hum then
			hum:ChangeState(Enum.HumanoidStateType.Physics)
		end
	end)
end

-- // Stop Fly
local function stopFly()
	flying = false
	local char = LocalPlayer.Character
	if char then
		local root = getRoot(char)
		if root then
			if root:FindFirstChild(velocityHandlerName) then root[velocityHandlerName]:Destroy() end
			if root:FindFirstChild(gyroHandlerName) then root[gyroHandlerName]:Destroy() end
		end
		local hum = char:FindFirstChildWhichIsA("Humanoid")
		if hum then
			-- balikkin state normal (biar bisa lari/jalan)
			hum:SetStateEnabled(Enum.HumanoidStateType.FallingDown, true)
			hum:SetStateEnabled(Enum.HumanoidStateType.Ragdoll, true)
			hum:SetStateEnabled(Enum.HumanoidStateType.Freefall, true)
			hum:ChangeState(Enum.HumanoidStateType.GettingUp)
		end
	end
end

-- // GUI Utama
local ScreenGui = Instance.new("ScreenGui", LocalPlayer.PlayerGui)
local Frame = Instance.new("Frame", ScreenGui)
Frame.Size = UDim2.new(0,200,0,75)
Frame.Position = UDim2.new(0.5,-100,0,100)
Frame.BackgroundColor3 = Color3.fromRGB(255,200,255)
Frame.Active = true
Frame.Draggable = true

-- Tombol Fly
local flyBtn = Instance.new("TextButton", Frame)
flyBtn.Size = UDim2.new(0.33,0,1,0)
flyBtn.Position = UDim2.new(0,0,0,0)
flyBtn.Text = "Fly"
flyBtn.BackgroundColor3 = Color3.fromRGB(200,255,200)

-- Tombol UnFly
local unflyBtn = Instance.new("TextButton", Frame)
unflyBtn.Size = UDim2.new(0.33,0,1,0)
unflyBtn.Position = UDim2.new(0.33,0,0,0)
unflyBtn.Text = "UnFly"
unflyBtn.BackgroundColor3 = Color3.fromRGB(255,200,200)

-- Tombol Teleport
local teleportBtn = Instance.new("TextButton", Frame)
teleportBtn.Size = UDim2.new(0.34,0,1,0)
teleportBtn.Position = UDim2.new(0.66,0,0,0)
teleportBtn.Text = "Teleport"
teleportBtn.BackgroundColor3 = Color3.fromRGB(200,200,255)

-- // ScrollingFrame list checkpoint
local listFrame = Instance.new("ScrollingFrame", ScreenGui)
listFrame.Size = UDim2.new(0,200,0,200)
listFrame.Position = UDim2.new(0.5,-100,0,180)
listFrame.BackgroundColor3 = Color3.fromRGB(240,240,255)
listFrame.Visible = false
listFrame.Active = true
listFrame.Draggable = true
listFrame.ScrollBarThickness = 6
listFrame.CanvasSize = UDim2.new(0,0,0,0)

local uiList = Instance.new("UIListLayout", listFrame)
uiList.SortOrder = Enum.SortOrder.LayoutOrder
uiList.Padding = UDim.new(0,2)

uiList.Changed:Connect(function()
	listFrame.CanvasSize = UDim2.new(0,0,0,uiList.AbsoluteContentSize.Y)
end)

-- Tombol Close di listFrame
local closeBtn = Instance.new("TextButton", listFrame)
closeBtn.Size = UDim2.new(1,0,0,25)
closeBtn.Text = "X Tutup"
closeBtn.BackgroundColor3 = Color3.fromRGB(255,180,180)

closeBtn.MouseButton1Click:Connect(function()
	listFrame.Visible = false
end)

-- // Ambil semua checkpoint
local function getCheckpoints()
	local checkpoints = {}
	for _, obj in pairs(workspace:GetDescendants()) do
		if obj:IsA("SpawnLocation") or obj.Name:lower():match("checkpoint") then
			table.insert(checkpoints, obj)
		end
	end
	return checkpoints
end

-- // Refresh tombol checkpoint
local function refreshCheckpointList()
	-- hapus tombol lama (selain tombol close)
	for _, child in pairs(listFrame:GetChildren()) do
		if child:IsA("TextButton") and child ~= closeBtn then
			child:Destroy()
		end
	end

	local checkpoints = getCheckpoints()
	for i, cp in ipairs(checkpoints) do
		local btn = Instance.new("TextButton", listFrame)
		btn.Size = UDim2.new(1,0,0,25)
		btn.Text = i..". "..cp.Name
		btn.BackgroundColor3 = Color3.fromRGB(220,220,240)

		btn.MouseButton1Click:Connect(function()
			local char = LocalPlayer.Character
			local root = char and char:FindFirstChild("HumanoidRootPart")
			if root and cp then
				root.CFrame = cp.CFrame + Vector3.new(0,5,0) -- naik 5 stud biar ga nyangkut
			end
		end)
	end
end

local coordLabel = Instance.new("TextLabel", ScreenGui)
coordLabel.Size = UDim2.new(0,200,0,25)
coordLabel.Position = UDim2.new(0.5,-100,0,180+210) -- di bawah list / frame
coordLabel.BackgroundColor3 = Color3.fromRGB(230,230,230)
coordLabel.TextColor3 = Color3.fromRGB(0,0,0)
coordLabel.TextScaled = true
coordLabel.Text = "Koordinat: (0,0,0)"

-- Update realtime
RunService.RenderStepped:Connect(function()
	local char = LocalPlayer.Character
	local root = char and char:FindFirstChild("HumanoidRootPart")
	if root then
		local pos = root.Position
		coordLabel.Text = string.format("Koordinat: (%.1f, %.1f, %.1f)", pos.X, pos.Y, pos.Z)
	end
end)

-- // Connections
flyBtn.MouseButton1Click:Connect(mobileFly)
unflyBtn.MouseButton1Click:Connect(stopFly)

teleportBtn.MouseButton1Click:Connect(function()
	if listFrame.Visible then
		listFrame.Visible = false
	else
		refreshCheckpointList()
		listFrame.Visible = true
	end
end)

-- // Animasi tulisan Bardenss (2 detik)
local animLabel = Instance.new("TextLabel", ScreenGui)
animLabel.Size = UDim2.new(0,300,0,50)
animLabel.Position = UDim2.new(0.5,-150,0.5,-25)
animLabel.BackgroundTransparency = 1
animLabel.Text = "Ｂａｒｄｅｎｓｓ"
animLabel.TextColor3 = Color3.fromRGB(255,150,255)
animLabel.Font = Enum.Font.Fantasy
animLabel.TextScaled = true

TweenService:Create(animLabel, TweenInfo.new(2), {TextTransparency = 1}):Play()
task.wait(2)
animLabel:Destroy()