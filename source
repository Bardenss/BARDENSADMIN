-- ==========================
-- Bardenss Fly GUI Hybrid (PC + Mobile)
-- ==========================
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local UIS = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local isMobile = (player.PlayerGui.TouchGui ~= nil) or (UIS.TouchEnabled)

-- ==========================
-- GUI Setup
-- ==========================
local gui = Instance.new("ScreenGui")
gui.Name = "BardenssUI"
gui.ResetOnSpawn = false
gui.Parent = player:WaitForChild("PlayerGui")

-- Animasi teks Bardenss
local textLabel = Instance.new("TextLabel")
textLabel.Parent = gui
textLabel.Size = UDim2.new(1,0,0.2,0)
textLabel.Position = UDim2.new(0,0,0.4,0)
textLabel.BackgroundTransparency = 1
textLabel.Text = "Bardenss"
textLabel.TextColor3 = Color3.fromRGB(255,105,180)
textLabel.TextScaled = true
textLabel.Font = Enum.Font.Cartoon
textLabel.TextTransparency = 1

for i = 1,0,-0.05 do textLabel.TextTransparency = i task.wait(0.02) end
task.wait(2)
for i = 0,1,0.05 do textLabel.TextTransparency = i task.wait(0.02) end
textLabel:Destroy()

-- ==========================
-- Bar GUI
-- ==========================
local frame = Instance.new("Frame")
frame.Size = UDim2.new(0,220,0,120)
frame.Position = UDim2.new(0,50,0,150)
frame.BackgroundColor3 = Color3.fromRGB(255,200,230)
frame.Visible = true
frame.Parent = gui

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0,12)
UICorner.Parent = frame

-- Minimize button
local minimizeBtn = Instance.new("TextButton")
minimizeBtn.Size = UDim2.new(0,25,0,25)
minimizeBtn.Position = UDim2.new(1,-30,0,5)
minimizeBtn.Text = "-"
minimizeBtn.BackgroundColor3 = Color3.fromRGB(255,150,200)
minimizeBtn.Parent = frame

-- Fly Button
local flyBtn = Instance.new("TextButton")
flyBtn.Size = UDim2.new(0,180,0,50)
flyBtn.Position = UDim2.new(0,20,0,50)
flyBtn.BackgroundColor3 = Color3.fromRGB(255,180,220)
flyBtn.Font = Enum.Font.Cartoon
flyBtn.TextSize = 22
flyBtn.Text = "Fly"
flyBtn.Parent = frame

-- Icon B (restore)
local iconB = Instance.new("TextButton")
iconB.Size = UDim2.new(0,40,0,40)
iconB.Position = UDim2.new(0,50,0,150)
iconB.Text = "B"
iconB.Font = Enum.Font.Cartoon
iconB.TextSize = 24
iconB.BackgroundColor3 = Color3.fromRGB(255,150,200)
iconB.Visible = false
iconB.Parent = gui

-- Button events
minimizeBtn.MouseButton1Click:Connect(function()
    frame.Visible = false
    iconB.Visible = true
end)
iconB.MouseButton1Click:Connect(function()
    frame.Visible = true
    iconB.Visible = false
end)

-- ==========================
-- Fly System
-- ==========================
local flying = false
local flySpeed = 60
local ascend, descend = false, false
local connection = nil

local function startFly()
    if flying then return end
    local char = player.Character
    if not char or not char:FindFirstChild("HumanoidRootPart") then return end
    local hrp = char.HumanoidRootPart
    local hum = char:FindFirstChildOfClass("Humanoid")
    if not hum then return end

    flying = true

    if isMobile then
        -- Mobile fly (BodyVelocity)
        hum.PlatformStand = true
        local bv = Instance.new("BodyVelocity")
        bv.Name = "FlyVelocity"
        bv.MaxForce = Vector3.new(1e5,1e5,1e5)
        bv.Velocity = Vector3.new(0,0,0)
        bv.Parent = hrp

        connection = RunService.RenderStepped:Connect(function()
            local moveDir = Vector3.new()
            if hum.MoveDirection.Magnitude > 0 then moveDir = hum.MoveDirection.Unit end
            bv.Velocity = Vector3.new(moveDir.X,1,moveDir.Z)*50
        end)
    else
        -- PC fly (VectorForce + AlignOrientation)
        hum:ChangeState(Enum.HumanoidStateType.Physics)
        local att = Instance.new("Attachment", hrp)
        local vf = Instance.new("VectorForce")
        vf.Attachment0 = att
        vf.RelativeTo = Enum.ActuatorRelativeTo.World
        vf.Force = Vector3.zero
        vf.Parent = hrp
        local ao = Instance.new("AlignOrientation")
        ao.Attachment0 = att
        ao.Mode = Enum.OrientationAlignmentMode.OneAttachment
        ao.Responsiveness = 200
        ao.Parent = hrp

        local keyDown, keyUp
        keyDown = UIS.InputBegan:Connect(function(input, gp)
            if gp then return end
            if input.KeyCode == Enum.KeyCode.E then ascend = true end
            if input.KeyCode == Enum.KeyCode.Q then descend = true end
        end)
        keyUp = UIS.InputEnded:Connect(function(input, gp)
            if gp then return end
            if input.KeyCode == Enum.KeyCode.E then ascend = false end
            if input.KeyCode == Enum.KeyCode.Q then descend = false end
        end)

        connection = RunService.Heartbeat:Connect(function()
            if not flying then
                connection:Disconnect()
                keyDown:Disconnect()
                keyUp:Disconnect()
                vf:Destroy()
                ao:Destroy()
                att:Destroy()
                hum:ChangeState(Enum.HumanoidStateType.GettingUp)
                return
            end

            local cam = workspace.CurrentCamera
            local dir = Vector3.zero
            if UIS:IsKeyDown(Enum.KeyCode.W) then dir += cam.CFrame.LookVector end
            if UIS:IsKeyDown(Enum.KeyCode.S) then dir -= cam.CFrame.LookVector end
            if UIS:IsKeyDown(Enum.KeyCode.A) then dir -= cam.CFrame.RightVector end
            if UIS:IsKeyDown(Enum.KeyCode.D) then dir += cam.CFrame.RightVector end
            if ascend then dir += Vector3.new(0,1,0) end
            if descend then dir -= Vector3.new(0,1,0) end

            if dir.Magnitude > 0 then dir = dir.Unit * flySpeed end
            vf.Force = (dir - hrp.AssemblyLinearVelocity) * hrp.AssemblyMass * 5
            ao.CFrame = CFrame.lookAt(hrp.Position, hrp.Position + cam.CFrame.LookVector)
        end)
    end
end

local function stopFly()
    flying = false
    local char = player.Character
    if char then
        local hum = char:FindFirstChildOfClass("Humanoid")
        local hrp = char:FindFirstChild("HumanoidRootPart")
        if hum then hum.PlatformStand = false end
        if hrp then
            local bv = hrp:FindFirstChild("FlyVelocity")
            if bv then bv:Destroy() end
        end
    end
    if connection then connection:Disconnect() connection=nil end
end

flyBtn.MouseButton1Click:Connect(function()
    if not flying then
        startFly()
        flyBtn.Text = "UnFly"
    else
        stopFly()
        flyBtn.Text = "Fly"
    end
end)

player.CharacterAdded:Connect(function()
    stopFly()
    flyBtn.Text = "Fly"
end)